<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Cluster Maintenance</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="09fec352-4a9e-4021-ad67-d8e707e762bd" class="page sans"><header><img class="page-cover-image" src="Scheduling%20801cba32ed774f60b88fd32e4a4c5e2f/k8s.png" style="object-position:center 50%"/><div class="page-header-icon page-header-icon-with-cover"><img class="icon" src="Scheduling%20801cba32ed774f60b88fd32e4a4c5e2f/logo.png"/></div><h1 class="page-title">Cluster Maintenance</h1><p class="page-description"></p></header><div class="page-body"><ul id="e3b2ac55-1ba1-4525-a645-08fd43ff3bf6" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>OS Upgrade</strong></mark></summary><ul id="cd088539-e5db-49c8-adbf-a28077b50312" class="bulleted-list"><li style="list-style-type:disc">Assuming you have a cluster with a few nodes and pods serving applications. Suddenly one of the worker nodes goes down, and of course, the Pods are inaccessible.</li></ul><ul id="a5decafd-ed96-4a90-a6bd-ed30946131d1" class="bulleted-list"><li style="list-style-type:disc">If the node comes back online immediately, then the K<strong>ubelet </strong>process starts and the Pods come back online. However, Kubernetes will consider the Pods dead if the node doesn’t return online after 5 minutes (which is the default <strong>Pod eviction timeout</strong> value).</li></ul><ul id="e0e86392-f804-4f4f-a21f-3d4eb10bbe12" class="bulleted-list"><li style="list-style-type:disc">If the Pods were part of a <strong>ReplicaSet </strong>then they are recreated on other nodes.</li></ul><ul id="2fd3d432-821d-48f2-a234-cac6dcc5d3d6" class="bulleted-list"><li style="list-style-type:disc">A safer way to upgrade your node without losing your Pods is to <strong>drain</strong> the node. So that all the workloads are moved to other nodes in the cluster. Technically, they are not moved. When you drain the node the PODs are gracefully terminated from the node that they’re on and recreated on another and the node is also marked as unschedulable “cordoned”.<ul id="e142ee4c-1e72-43a6-81e7-e44346a1035d" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-blue"><code>$ kubectl drain node1</code></mark></li></ul></li></ul><ul id="d41cf932-6691-41b5-87df-c111cdeabbac" class="bulleted-list"><li style="list-style-type:disc">After upgrading your node, make sure to run the <mark class="highlight-blue"><code>$ kubectl uncordon node1</code></mark> to make it schedulable again. and new Pods can be scheduled again on that node.</li></ul><ul id="819bdc02-75e9-497c-acf7-b36bc39d80cc" class="bulleted-list"><li style="list-style-type:disc">Another command <mark class="highlight-blue"><code>$ kubectl cordon nod1</code></mark>and unline the <strong>drain </strong>command doesn’t terminate pods, instead it just marks the node unschedulable to make sure that new Pods are not scheduled on that node.</li></ul></details></li></ul><ul id="f3402daa-6451-4069-aef3-aaf556841274" class="toggle"><li><details open=""><summary><strong><mark class="highlight-blue">Cluster Upgrade</mark></strong></summary><ul id="9caeabaa-89d0-459d-b6a4-ab06b8192986" class="bulleted-list"><li style="list-style-type:disc"><strong>Kube API Server</strong> is the primary component in the control plane and none of the other components should ever be at a higher version than it.</li></ul><ul id="0d2c09c5-f138-4951-ac4a-373fa438b989" class="bulleted-list"><li style="list-style-type:disc">The <strong>controller manager</strong> and <strong>scheduler </strong>can be at one version lower.</li></ul><ul id="58a2ce84-6184-4524-a56c-53781058d674" class="bulleted-list"><li style="list-style-type:disc">If the <strong>Kube API server </strong>was at version <mark class="highlight-blue">X</mark>, the <strong>controller manager </strong>and the <strong>scheduler </strong>could be at <mark class="highlight-blue">X-1 </mark>and the<strong> Kubelet</strong> and <strong>kube-proxy </strong>components could be at <mark class="highlight-blue">X-2. </mark><strong>Kubectl</strong> can be either at <mark class="highlight-blue">X+1,</mark> <mark class="highlight-blue">X-1,</mark> or <mark class="highlight-blue">X.</mark></li></ul><ul id="ed5bc434-c2b7-4b16-8bfd-8f21a5add023" class="bulleted-list"><li style="list-style-type:disc">The <strong>coreDNS </strong>and<strong> etcd </strong>are external components so you don’t have to worry about them.</li></ul><ul id="6979022a-61c4-4f8a-9697-768dd4d0a6f6" class="bulleted-list"><li style="list-style-type:disc">Three Strategy to Upgrade Worker Nodes<ul id="7e7cdb2d-e466-4a83-b979-ef69c74ec15d" class="bulleted-list"><li style="list-style-type:circle">The <strong>first</strong> is to upgrade all of them at once. But then Pods are down and users are no longer able to access the applications.</li></ul><ul id="ca0e6b80-8847-4ea2-b209-c05ca8b6d201" class="bulleted-list"><li style="list-style-type:circle">The <strong>second</strong> is to upgrade one at a time.</li></ul><ul id="559a7c58-8b78-4b70-8224-0768862ebd85" class="bulleted-list"><li style="list-style-type:circle">The <strong>thirst </strong>strategy would be to add a new node to the cluster. Nodes with newer software versions.</li></ul></li></ul><ul id="82da3bbc-af1f-4e2c-bfdd-4438d1ad2b14" class="bulleted-list"><li style="list-style-type:disc">To know the information about the current version, Kubeadm tool version, latest stable version of Kubernetes. Run the following command → <mark class="highlight-blue"><code>$ kubeadm upgrade plan</code></mark></li></ul><ul id="91bb02c5-6e4c-45c6-83c7-604b0aeb47ac" class="bulleted-list"><li style="list-style-type:disc">To upgrade your Kubeadm tool use the following command → <mark class="highlight-blue"><code>$ sudo apt-get upgrade -y kubeadm=1.12.0-00</code></mark><mark class="highlight-blue"> </mark></li></ul><ul id="dfdb92a1-b46a-442e-af86-fa3b20fcb368" class="bulleted-list"><li style="list-style-type:disc">To upgrade your Kubernetes cluster → <mark class="highlight-blue"><code>$ kubeadm upgrade apply v1.12.0</code></mark></li></ul><ul id="c7c23606-19a9-4082-b5b1-78a3f93a9051" class="bulleted-list"><li style="list-style-type:disc">To upgrade the kubelet → <mark class="highlight-blue"><code>$ sudo apt-get upgrade -y kubelet=1.12.0-00</code></mark><mark class="highlight-blue"> </mark>and then restart it <code><mark class="highlight-blue">$ systemctl restart kubelet</mark></code></li></ul><ul id="fd08eddd-738d-4827-afaf-14d2bc0c304b" class="bulleted-list"><li style="list-style-type:disc">Do the same on the worker nodes</li></ul><ul id="8e826584-b900-4660-898f-d4dc411a5cd3" class="bulleted-list"><li style="list-style-type:disc"><a href="https://www.golinuxcloud.com/kubernetes-upgrade-version/">https://www.golinuxcloud.com/kubernetes-upgrade-version/</a></li></ul><ul id="ab61d615-62d8-4d91-8135-01b96c2f92c2" class="bulleted-list"><li style="list-style-type:disc"><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</a></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f6a603ac-f2af-41a8-bc9c-bd75d3f6dfc7" class="code"><code class="language-Shell">#upgrading the control plane
$ k drain controlplane --ignore-daemonsets
$ apt-cache madison kubeadm &amp;&amp; apt-mark unhold kubeadm
$ apt-get update &amp;&amp; apt-get install -y kubeadm=&#x27;1.27.0-00&#x27;
$ apt-mark hold kubeadm
$ kubeadm upgrade plan
$ kubeadm upgrade apply v1.27.0
$ apt-mark unhold kubelet kubectl
$ apt-get update &amp;&amp; apt-get install -y kubelet=&#x27;1.27.0-00&#x27; kubectl=&#x27;1.27.0-00&#x27;
$ apt-mark hold kubelet kubectl
$ systemctl daemon-reload &amp;&amp; systemctl restart kubelet
$ kubectl uncordon controlplane
# upgrading the node
$ k drain</code></pre></details></li></ul><ul id="24e44d08-a656-48ee-b966-24f94730fbd0" class="toggle"><li><details open=""><summary><mark class="highlight-blue"><strong>Backup and Restore</strong></mark></summary><h3 id="6cc1ab8a-9f9f-4bd5-a6aa-a8120670b79f" class=""><mark class="highlight-blue">Backup - Resource Configs</mark></h3><ul id="4c5e0cfb-640e-49fe-ae20-2d3ce17952b8" class="bulleted-list"><li style="list-style-type:disc">At times, we use the imperative way of creating an object by executing a command, such as creating a namespace, secret, configmaps, or exposing applications. </li></ul><ul id="54c11d37-96f8-4d3b-b924-7af825ce90f8" class="bulleted-list"><li style="list-style-type:disc">A preferred approach is to use the declarative way by first creating a definition file and then running the <strong>kubectl apply</strong> command on that file. Since we can save our manifests and manage them on a source code repository like GitHub and easily reuse them at a later time or share with others. With that even when we lose our entire cluster, we can redeploy our application again by simply applying these manifests on them.</li></ul><ul id="40e27b80-01bf-4e23-a6fd-977293c607ed" class="bulleted-list"><li style="list-style-type:disc">What if our team memberes use the imperative way? Well, at this point we use solution like velero to constantly query the Kube API server.<br/><br/><mark class="highlight-blue"><code>$ kubectl get all --all-namespaces -o yaml &gt; all-deploy-services.yml</code></mark><mark class="highlight-blue"> </mark></li></ul><h3 id="ebf2067e-387d-4167-9c75-956defb455f7" class=""><mark class="highlight-blue">Backup - ETCD</mark></h3><ul id="255f0d60-0ab8-4873-8bb6-881da0650dbc" class="bulleted-list"><li style="list-style-type:disc">The etcd cluster stores information about the state of the cluster, nodes and about every other resource created within the cluster. So it is really important to backup the etcd server to recover Kubernetes cluster under disaster scenarios, such as losing all control plane nodes.</li></ul><ul id="2ae0ed08-5a9d-46f0-bd57-a7fda84db195" class="bulleted-list"><li style="list-style-type:disc"><strong>Backup etcd</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3f6ac57b-caac-4774-8887-f4ed01ddd6c7" class="code"><code class="language-Shell"># Backup example
$ ETCDCTL_API=3 etcdctl --endpoints $ENDPOINT snapshot save sanpshot.db
$ ETCDCTL_API=3 etcdctl --write-out snapshot status snapshot.db
# backup options
$ ETCDCTL_API=3 etcdctl \
--enpoints=https://127.0.0.1:2379 \
--cacert=&lt;truster-ca-file&gt; \
--cert=&lt;cert-file&gt; \
--key=&lt;key-file&gt; \
snapshot save &lt;backup-file-location&gt;

## Backup lab
ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --cacert=/etc/kubernetes/pki/etcd/ca.crt snapshot save /opt/snapshot-pre-boot.db</code></pre></li></ul><ul id="7699b79c-e5e1-40f7-b8ea-d5f3466ccced" class="bulleted-list"><li style="list-style-type:disc"><strong>Restore etcd</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1d47a874-5e00-4fe2-a6dc-b3d8f513fbe3" class="code"><code class="language-Shell">#Restore example
$ ETCDCTL_API=3 etcdctl --endpoints $ENDPOINT snapshot restore snapshot.db
#Restore options
$ ETCDCTL_API=3 etcdctl --data-dir &lt;data-dir-location&gt; snapshot restore snapshot.db

=&gt; where &lt;data-dir-location&gt; is a directory that will be created during the restore process

## Restore Lab
$ ETCDCTL_API=3 etcdctl --data-dir=/var/lib/etcd-restore snapshot restore /opt/snapshot-pre-boot.db
$ vim /etc/kubernetes/manifests/etcd.yml 
  %s/\/var\/lib\/etcd/\/var\/lib\/etcd-restore</code></pre><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="901527be-42a3-48d6-8197-b901e38e6ec3"><div style="font-size:1.5em"><span class="icon">⚠️</span></div><div style="width:100%">Do not forget to change the --data-dir option in the /etc/kubernetes/manifests/etcd.yml file</div></figure></li></ul><h3 id="f9b7e058-146a-4537-bec3-28cbe9fecddd" class=""><mark class="highlight-blue">Notes about etcd</mark></h3><ul id="f897f729-9c38-497e-8c0d-fe9c959febc7" class="bulleted-list"><li style="list-style-type:disc">You can either install etcd server as an object in your kubernetes cluster, or as an external server.</li></ul><ul id="be671aa2-f6e8-4d5e-ac9d-849c9ca22f45" class="bulleted-list"><li style="list-style-type:disc">To grab the ip address of the external etcd server use <code>$ ps -ex | grep etcd</code> or check the content under the manifest file of the Kube API server.<br/><br/></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fe13d821-a1ea-46b2-a971-c5df606d7171" class="code"><code class="language-Shell">#list proc
$ ps -ef | grep etcd
#change context
$ kubectl config use-context cluster2
#get the members of the etcd cluster
$ ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem member list
## Restore from external etcd
$ ETCDCTL_API=3 etcdctl --data-dir=/var/lib/etcd-data-new snapshot restore cluster2.db
# change on the /etc/systemd/system/etcd.service file
# make sure to have the right permission and owners of the new --data-dir
# restart the kubelet service, and delete the scheduler/cmanager pods.
# reload the daemon and you are good to go.</code></pre><ul id="242e8bb2-a484-40f1-8b86-745b4f86c863" class="bulleted-list"><li style="list-style-type:disc"><strong><mark class="highlight-blue">REFs</mark></strong><ul id="49889ccc-cf95-45c3-8618-542c9f57a255" class="bulleted-list"><li style="list-style-type:circle"><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster">https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster</a></li></ul><ul id="a9997c32-9e53-4013-ab8d-ee5eddb5e7b1" class="bulleted-list"><li style="list-style-type:circle"><a href="https://velero.io/docs/v1.12/migration-case/">https://velero.io/docs/v1.12/migration-case/</a></li></ul></li></ul></details></li></ul><p id="5db7f64d-2313-4085-87b1-29d51251e7f4" class="">
</p><p id="44cdb648-faf8-4a39-a7c0-ec33756f5637" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>