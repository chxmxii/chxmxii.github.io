<!doctype html><html lang=en><link rel=icon href=https://chxmxii.tech/mor.jpg type=image/icontype><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:chxmxii_]"><meta name=description content="Create Pods in Kubernetes Cluster The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform as they are planning to migrate most of their applications on Kubernetes platform. Recently one of the team members has been assigned a task to create a pod as per details mentioned below: Create a pod named pod-httpd using httpd image with latest tag only and remember to mention the tag i."><meta name=keywords content=",DevOps,Sysadmin"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://chxmxii.tech/writeups/writeup10.txt/><title>KKE - Kubernetes Challenges :: Mouhib CHVMSI
</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://chxmxii.tech/main.f9efc3f937d6f1177418d008b46474fa1df286cee3b42e861ea657dc0d31f2fe.css><link rel=apple-touch-icon sizes=180x180 href=https://chxmxii.tech/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://chxmxii.tech/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://chxmxii.tech/favicon-16x16.png><link rel=manifest href=https://chxmxii.tech/site.webmanifest><link rel=mask-icon href=https://chxmxii.tech/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://chxmxii.tech/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="KKE - Kubernetes Challenges"><meta itemprop=description content="Create Pods in Kubernetes Cluster The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform as they are planning to migrate most of their applications on Kubernetes platform. Recently one of the team members has been assigned a task to create a pod as per details mentioned below: Create a pod named pod-httpd using httpd image with latest tag only and remember to mention the tag i."><meta itemprop=datePublished content="2023-08-25T00:00:00+00:00"><meta itemprop=dateModified content="2023-08-25T00:00:00+00:00"><meta itemprop=wordCount content="5850"><meta itemprop=image content="https://chxmxii.tech"><meta itemprop=keywords content="DevOps,Sysadmin,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://chxmxii.tech"><meta name=twitter:title content="KKE - Kubernetes Challenges"><meta name=twitter:description content="Create Pods in Kubernetes Cluster The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform as they are planning to migrate most of their applications on Kubernetes platform. Recently one of the team members has been assigned a task to create a pod as per details mentioned below: Create a pod named pod-httpd using httpd image with latest tag only and remember to mention the tag i."><meta property="og:title" content="KKE - Kubernetes Challenges"><meta property="og:description" content="Create Pods in Kubernetes Cluster The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform as they are planning to migrate most of their applications on Kubernetes platform. Recently one of the team members has been assigned a task to create a pod as per details mentioned below: Create a pod named pod-httpd using httpd image with latest tag only and remember to mention the tag i."><meta property="og:type" content="article"><meta property="og:url" content="https://chxmxii.tech/writeups/writeup10.txt/"><meta property="og:image" content="https://chxmxii.tech"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2023-08-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-25T00:00:00+00:00"><meta property="og:see_also" content="https://chxmxii.tech/posts/2023/11/boost-your-apps-security-with-this-open-source-tool./"><meta property="og:see_also" content="https://chxmxii.tech/posts/2023/09/certifications-exam-notes/"><meta property="og:see_also" content="https://chxmxii.tech/writeups/writeup09.txt/"><meta property="og:see_also" content="https://chxmxii.tech/writeups/writeup04.txt/"><meta property="og:see_also" content="https://chxmxii.tech/writeups/writeup01.txt/"><meta property="article:published_time" content="2023-08-25 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://chxmxii.tech/ style=text-decoration:none><div class=logo><span class=logo__mark></span><span class=logo__text>C:\Users\chxmxii\</span>
<span class=logo__text style=color:#ff3c36>writeup10.txt</span>
<span class=logo__cursor style=background-color:#ff3c36></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://chxmxii.tech/about.txt/ style=text-decoration:none class=name>About</a></li><li><a href=https://chxmxii.tech/posts/ style=text-decoration:none class=name>Posts</a></li><li><a href=https://chxmxii.tech/projects/ style=text-decoration:none class=name>Projects</a></li><li><a href=https://chxmxii.tech/writeups/ style=text-decoration:none class=name>Writeups</a></li><li><a href=https://chxmxii.tech/cv.pdf style=text-decoration:none class=name>~Resume</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://chxmxii.tech/writeups/writeup10.txt/>KKE - Kubernetes Challenges</a></h2><div class=post-content><h2 id=fileskubepngcenter><img src=https://chxmxii.tech/files/kube.png#center alt></h2><h2 id=create-pods-in-kubernetes-cluster>Create Pods in Kubernetes Cluster</h2><ul><li>The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform as they are planning to migrate most of their applications on Kubernetes platform. Recently one of the team members has been assigned a task to create a pod as per details mentioned below:</li><li>Create a pod named pod-httpd using httpd image with latest tag only and remember to mention the tag i.e httpd:latest.</li><li>Labels app should be set to httpd_app, also container should be named as httpd-container.</li></ul><h6 id=solution>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-httpd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>httpd:latest</span>
</span></span></code></pre></div></li></ul><hr><h2 id=create-deployments-in-kubernetes-cluster>Create Deployments in Kubernetes Cluster</h2><ul><li>The Nautilus DevOps team has started practicing some pods and services deployment on Kubernetes platform, as they are planning to migrate most of their applications on Kubernetes. Recently one of the team members has been assigned a task to create a deployment as per details mentioned below:</li><li>Create a deployment named httpd to deploy the application httpd using the image httpd:latest (remember to mention the tag as well)</li></ul><h6 id=solution-1>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>httpd:latest</span>
</span></span></code></pre></div></li></ul><hr><h2 id=create-namespaces-in-kubernetes-cluster>Create Namespaces in Kubernetes Cluster</h2><ul><li><p>The Nautilus DevOps team is planning to deploy some micro services on Kubernetes platform. The team has already set up a Kubernetes cluster and now they want set up some namespaces, deployments etc. Based on the current requirements, the team has shared some details as below:</p></li><li><p>Create a namespace named dev and create a POD under it; name the pod dev-nginx-pod and use nginx image with latest tag only and remember to mention tag i.e nginx:latest.</p></li></ul><h6 id=solution-2>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev-nginx-pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-dev</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span></code></pre></div></li></ul><hr><h2 id=set-limits-for-resources-in-kubernetes>Set Limits for Resources in Kubernetes</h2><ul><li><p>Recently some of the performance issues were observed with some applications hosted on Kubernetes cluster. The Nautilus DevOps team has observed some resources constraints, where some of the applications are running out of resources like memory, cpu etc., and some of the applications are consuming more resources than needed. Therefore, the team has decided to add some limits for resources utilization. Below you can find more details.</p></li><li><p>Create a pod named httpd-pod and a container under it named as httpd-container, use httpd image with latest tag only and remember to mention tag i.e httpd:latest and set the following limits:
<code>Requests: Memory: 15Mi, CPU: 100m</code>
<code>Limits: Memory: 20Mi, CPU: 100m</code></p></li></ul><h6 id=solution-3>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  -  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-container</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>httpd:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;15Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>limits</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;20Mi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;100m&#34;</span>
</span></span></code></pre></div></li></ul><hr><h2 id=rolling-updates-in-kubernetes>Rolling Updates in Kubernetes</h2><ul><li>We have an application running on Kubernetes cluster using nginx web server. The Nautilus application development team has pushed some of the latest changes and those changes need be deployed. The Nautilus DevOps team has created an image nginx:1.19 with the latest changes.</li><li>Perform a rolling update for this application and incorporate nginx:1.19 image. The deployment name is nginx-deployment</li><li>Make sure all pods are up and running afte r the update.</li></ul><h6 id=solution-4>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get all
</span></span><span style=display:flex><span>$ kubectl get deployment nginx-deployment -o yaml
</span></span><span style=display:flex><span>$ kubectl set image deployment/nginx-deployment nginx-container<span style=color:#f92672>=</span>nginx:1.19
</span></span><span style=display:flex><span>$ watch kubectl get pods 
</span></span><span style=display:flex><span>$ kubectl rollout status deployment nginx-deployment
</span></span><span style=display:flex><span>$ kubectl describe deployment nginx-deployment
</span></span></code></pre></div></li></ul><hr><h2 id=rollback-a-deployment-in-kubernetes>Rollback a Deployment in Kubernetes</h2><ul><li>This morning the Nautilus DevOps team rolled out a new release for one of the applications. Recently one of the customers logged a complaint which seems to be about a bug related to the recent release. Therefore, the team wants to rollback the recent release.</li><li>There is a deployment named nginx-deployment; roll it back to the previous revision.</li></ul><h6 id=solution-5>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get deployment
</span></span><span style=display:flex><span>$ kubectl get pods
</span></span><span style=display:flex><span>$ kubectl rollout undo deployment  nginx-deployment 
</span></span><span style=display:flex><span>$ kubectl rollout status deployment  nginx-deployment 
</span></span></code></pre></div></li></ul><hr><h2 id=create-cronjobs-in-kubernetes>Create Cronjobs in Kubernetes</h2><ul><li>There are some jobs/tasks that need to be run regularly on different schedules. Currently the Nautilus DevOps team is working on developing some scripts that will be executed on different schedules, but for the time being the team is creating some cron jobs in Kubernetes cluster with some dummy commands (which will be replaced by original scripts later). Create a cronjob as per details given below:</li><li>Create a cronjob named datacenter.</li><li>Set Its schedule to something like */8 * * * *, you set any schedule for now.</li><li>Container name should be cron-datacenter.</li><li>Use nginx image with latest tag only and remember to mention the tag i.e nginx:latest.</li><li>Run a dummy command echo Welcome to xfusioncorp!.</li><li>Ensure restart policy is OnFailure</li></ul><h6 id=solution-6>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>batch/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CronJob</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#34;*/8 * * * *&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>jobTemplate</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cron-datacenter</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>command</span>: 
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>/bin/sh</span>
</span></span><span style=display:flex><span>            - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>echo Welcome to xfusioncorp!</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>OnFailure</span>
</span></span></code></pre></div></li></ul><hr><h2 id=countdown-job-in-kubernetes>Countdown job in Kubernetes</h2><ul><li>The Nautilus DevOps team is working on to create few jobs in Kubernetes cluster. They might come up with some real scripts/commands to use, but for now they are preparing the templates and testing the jobs with dummy commands. Please create a job template as per details given below:</li><li>Create a job countdown-nautilus.</li><li>The spec template should be named as countdown-nautilus (under metadata), and the container should be named as container-countdown-nautilus</li><li>Use image debian with latest tag only and remember to mention tag i.e debian:latest, and restart policy should be Never.</li><li>Use command sleep 5</li></ul><h6 id=solution-7>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>batch/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Job</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>countdown-datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>countdown-datacenter</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      -  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>container-countdown-datacenter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>centos:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;sleep&#34;</span>, <span style=color:#e6db74>&#34;5&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never </span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl apply -f job.yml</span>
</span></span><span style=display:flex><span><span style=color:#75715e># watch kubectl get jobs</span>
</span></span></code></pre></div></li></ul><hr><h2 id=troubleshoot-issue-with-pods>Troubleshoot Issue With Pods</h2><ul><li><p>One of the junior DevOps team members was working on to deploy a stack on Kubernetes cluster. Somehow the pod is not coming up and its failing with some errors. We need to fix this as soon as possible. Please look into it.</p></li><li><p>There is a pod named webserver and the container under it is named as nginx-container. It is using image nginx:latest</p></li><li><p>There is a sidecar container as well named sidecar-container which is using ubuntu:latest image.</p></li><li><p>Look into the issue and fix it, make sure pod is in running state and you are able to access the app.</p></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get pods
</span></span><span style=display:flex><span>$ kubectl describe pod/webserver
</span></span><span style=display:flex><span>$ kubectl edit pod/webserver
</span></span><span style=display:flex><span>$ watch kubectl get pods
</span></span></code></pre></div></li></ul><hr><h2 id=update-an-existing-deployment-in-kubernetes>Update an Existing Deployment in Kubernetes</h2><ul><li>There is an application deployed on Kubernetes cluster. Recently, the Nautilus application development team developed a new version of the application that needs to be deployed now. As per new updates some new changes need to be made in this existing setup. So update the deployment and service as per details mentioned below:</li><li>We already have a deployment named nginx-deployment and service named nginx-service. Some changes need to be made in this deployment and service, make sure not to delete the deployment and service.</li><li>Change the service nodeport from 30008 to 32165</li><li>Change the replicas count from 1 to 5</li><li>Change the image from nginx:1.18 to nginx:latest</li></ul><h6 id=solution-8>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get all
</span></span><span style=display:flex><span>$ kubectl get svc nginx-service -o yaml &gt; sv.yml <span style=color:#75715e>#edit the file and changee the port </span>
</span></span><span style=display:flex><span>$ kubectl get deployments nginx-deployment -o yaml &gt; dp.yml <span style=color:#75715e>#edit the fiile and change the rreplicatset and image version  $ kubectl describe svc nginx-service</span>
</span></span><span style=display:flex><span>$ kubectl describe deployments.apps nginx-deployment 
</span></span><span style=display:flex><span>$ kubectl apply -f sv.ym
</span></span><span style=display:flex><span>$ kubectl apply -f dp.yml
</span></span><span style=display:flex><span>$ kubectl describe svc nginx-service
</span></span><span style=display:flex><span>$ kubectl describe deployments.apps nginx-deployment
</span></span></code></pre></div></li></ul><hr><h2 id=replication-controller-in-kubernetes>Replication Controller in Kubernetes</h2><ul><li>The Nautilus DevOps team wants to create a ReplicationController to deploy several pods. They are going to deploy applications on these pods, these applications need highly available infrastructure. Below you can find exact details, create the ReplicationController accordingly.</li><li>Create a ReplicationController using httpd image, preferably with latest tag, and name it as httpd-replicationcontroller.</li><li>Labels app should be httpd_app, and labels type should be front-end. The container should be named as httpd-container and also make sure replica counts are 3.</li><li>All pods should be running state after deployment.</li></ul><h6 id=solution-9>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ReplicationController</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-replicationcontroller</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>front-end</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>front-end</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>httpd:latest</span>
</span></span></code></pre></div></li></ul><hr><h2 id=create-replicaset-in-kubernetes-cluster>Create Replicaset in Kubernetes Cluster</h2><ul><li>The Nautilus DevOps team is going to deploy some applications on kubernetes cluster as they are planning to migrate some of their existing applications there. Recently one of the team members has been assigned a task to write a template as per details mentioned below:</li><li>Create a ReplicaSet using nginx image with latest tag only and remember to mention tag i.e nginx:latest and name it as nginx-replicaset.</li><li>Labels app should be nginx_app, labels type should be front-end.</li><li>The container should be named as nginx-container; also make sure replicas counts are 4.</li></ul><h6 id=solution-10>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ReplicaSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-replicaset</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx_app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>front-end</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>front-end</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>front-end</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span></code></pre></div></li></ul><hr><h2 id=kuberentes-time-check-pod>Kuberentes time check pod</h2><ul><li>The Nautilus DevOps team want to create a time check pod in a particular Kubernetes namespace and record the logs. This might be initially used only for testing purposes, but later can be implemented in an existing cluster. Please find more details below about the task and perform it.</li><li>Create a pod called time-check in the datacenter namespace. This pod should run a container called time-check, container should use the busybox image with latest tag only and remember to mention tag i.e busybox:latest.</li><li>Create a config map called time-config with the data TIME_FREQ=11 in the same namespace.</li><li>The time-check container should run the command: while true; do date; sleep $TIME_FREQ;done and should write the result to the location /opt/data/time/time-check.log. Remember you will also need to add an environmental variable TIME_FREQ in the container, which should pick value from the config map TIME_FREQ key.</li><li>Create a volume log-volume and mount the same on /opt/data/time within the container.</li><li>Note: The kubectl utility on jump_host has been configured to work with the kubernetes cluster.</li></ul><h6 id=solution-11>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vi ns.yml
</span></span><span style=display:flex><span>vi configmap.yml
</span></span><span style=display:flex><span>vi pod.yml
</span></span><span style=display:flex><span>kubectl get ns
</span></span><span style=display:flex><span>kubectl get configmap -n datacenter
</span></span><span style=display:flex><span>kubectl get pods -n datacenter
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#ns.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#configmap.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>time-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>TIME_FREQ</span>: <span style=color:#e6db74>&#34;11&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#pod.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>time-check</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>time-check</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: [ <span style=color:#e6db74>&#34;sh&#34;</span>, <span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#34;while true; do date; sleep $TIME_FREQ;done &gt;&gt; /opt/data/time/time-check.log&#34;</span> ]
</span></span><span style=display:flex><span>      <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>TIME_FREQ</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>configMapKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>time-config</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>TIME_FREQ</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>log-volume</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/opt/data/time</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>log-volume</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>emptyDir </span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-apache-web-server-on-kubernetes-cluster>Deploy Apache Web Server on Kubernetes Cluster</h2><ul><li>There is an application that needs to be deployed on Kubernetes cluster under Apache web server. The Nautilus application development team has asked the DevOps team to deploy it. We need to develop a template as per requirements mentioned below:</li><li>Create a namespace named as httpd-namespace-devops.</li><li>Create a deployment named as httpd-deployment-devops under newly created namespace. For the deployment use httpd image with latest tag only and remember to mention the tag i.e httpd:latest, and make sure replica counts are 2.</li><li>Create a service named as httpd-service-devops under same namespace to expose the deployment, nodePort should be 30004.</li></ul><h6 id=solution-12>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>touch <span style=color:#f92672>{</span>ns,dep,srv<span style=color:#f92672>}</span>.yml
</span></span><span style=display:flex><span><span style=color:#75715e>#verify later</span>
</span></span><span style=display:flex><span>kubectl get deployment -n httpd-namespace-devops 
</span></span><span style=display:flex><span>kubectl get service -n httpd-namespace-devops
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#ns.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-namespace-devops</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#srv.yml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-service-devops</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>httpd-namespace-devops</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app_devops</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>3004</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#dep.yml</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-deployment-devops</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>httpd-namespace-devops</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app_devops</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd_app_devops</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-container</span>
</span></span></code></pre></div></li></ul><hr><h2 id=fix-issue-with-volumemounts-in-kubernetes>Fix Issue with VolumeMounts in Kubernetes:</h2><hr><h2 id=deploy-nginx-and-phpfpm-on-kubernetes>Deploy Nginx and Phpfpm on Kubernetes</h2><ul><li>The Nautilus Application Development team is planning to deploy one of the php-based application on Kubernetes cluster. As per discussion with DevOps team they have decided to use nginx and phpfpm. Additionally, they shared some custom configuration requirements. Below you can find more details. Please complete the task as per requirements mentioned below:</li><li>Create a service to expose this app, the service type must be NodePort, nodePort should be 30012.</li><li>Create a config map nginx-config for nginx.conf as we want to add some custom settings for nginx.conf.<ul><li>Change default port 80 to 8096 in nginx.conf.</li><li>Change default document root /usr/share/nginx to /var/www/html in nginx.conf.</li><li>Update directory index to index index.html index.htm index.php in nginx.conf.</li></ul></li><li>Create a pod named nginx-phpfpm .<ul><li>Create a shared volume shared-files that will be used by both containers (nginx and phpfpm) also it should be a emptyDir volume.</li><li>Map the ConfigMap we declared above as a volume for nginx container. Name the volume as nginx-config-volume, mount path should be /etc/nginx/nginx.conf and subPath should be nginx.conf</li><li>Nginx container should be named as nginx-container and it should use nginx:latest image. PhpFPM container should be named as php-fpm-container and it should use php:7.0-fpm image.</li><li>The shared volume shared-files should be mounted at /var/www/html location in both containers. Copy /opt/index.php from jump host to the nginx document root inside nginx container, once done you can access the app using App button on the top bar.</li></ul></li><li>Before clicking on finish button always make sure to check if all pods are in running state.</li><li>You can use any labels as per your choice.
=> Note: The kubectl utility on jump_host has been configured to work with the kubernetes cluster.</li></ul><h6 id=solution-13>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-phpfpm</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-phpfpm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>back-end</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8096</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8096</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30012</span> 
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx.conf</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    events {} 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    http {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      server {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        listen 8096;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        index index.html index.htm index.php;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        root  /var/www/html;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        location ~ \.php$ {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          include fastcgi_params;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          fastcgi_param REQUEST_METHOD $request_method;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          fastcgi_pass 127.0.0.1:9000;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    } </span>    
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-phpfpm</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-phpfpm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>back-end</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-files</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>emptyDir</span>: {}
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config-volume</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-files</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/www/html</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config-volume</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/nginx/nginx.conf</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>subPath</span>: <span style=color:#ae81ff>nginx.conf</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>php-fpm-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>php:7.0-fpm</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-files</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/www/html</span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>thor@jump_host ~$ kubectl apply -f .
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl get all
</span></span><span style=display:flex><span>NAME               READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/nginx-phpfpm   2/2     Running   <span style=color:#ae81ff>0</span>          5m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                   TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>          AGE
</span></span><span style=display:flex><span>service/kubernetes     ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP          76m
</span></span><span style=display:flex><span>service/nginx-phpfpm   NodePort    10.96.72.3   &lt;none&gt;        8096:30012/TCP   5m
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl cp /opt/index.php nginx-phpfpm:/var/www/html/ --container<span style=color:#f92672>=</span>nginx-container
</span></span></code></pre></div></li></ul><hr><hr><h2 id=kubernetes-shared-volumes>Kubernetes Shared Volumes</h2><ul><li>We are working on an application that will be deployed on multiple containers within a pod on Kubernetes cluster. There is a requirement to share a volume among the containers to save some temporary data. The Nautilus DevOps team is developing a similar template to replicate the scenario. Below you can find more details about it.</li><li>Create a pod named volume-share-xfusion.</li><li>For the first container, use image debian with latest tag only and remember to mention the tag i.e debian:latest, container should be named as volume-container-xfusion-1, and run a sleep command for it so that it remains in running state. Volume volume-share should be mounted at path /tmp/blog.</li><li>For the second container, use image debian with the latest tag only and remember to mention the tag i.e debian:latest, container should be named as volume-container-xfusion-2, and again run a sleep command for it so that it remains in running state. Volume volume-share should be mounted at path /tmp/apps.</li><li>Volume name should be volume-share of type emptyDir.</li><li>After creating the pod, exec into the first container i.e volume-container-xfusion-1, and just for testing create a file blog.txt with any content under the mounted path of first container i.e /tmp/blog.</li><li>The file blog.txt should be present under the mounted path /tmp/apps on the second container volume-container-xfusion-2 as well, since they are using a shared volume.</li></ul><h6 id=solution-14>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-share-xfusion</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-share</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>emptyDir</span>: {}
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>debian:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-container-xfusion-1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;sleep&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;1000&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-share</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/tmp/blog</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>debian:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-container-xfusion-2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>sleep</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;1000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>volume-share</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/tmp/apps        </span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>thor@jump_host ~$ kubectl get pods
</span></span><span style=display:flex><span>NAME                   READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>volume-share-xfusion   2/2     Running   <span style=color:#ae81ff>0</span>          8m15s
</span></span><span style=display:flex><span><span style=color:#75715e># list containers within the pod</span>
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl get pods volume-share-xfusion -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.spec[&#39;containers&#39;][*].name}&#34;</span>
</span></span><span style=display:flex><span>volume-container-xfusion-1 volume-container-xfusion-2
</span></span><span style=display:flex><span><span style=color:#75715e>#create blog.txt file within the first container</span>
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl exec pods/volume-share-xfusion -c volume-container-xfusion-1 -- touch /tmp/blog/blog.txt
</span></span><span style=display:flex><span><span style=color:#75715e>#verify in container 2</span>
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl exec pods/volume-share-xfusion -c volume-container-xfusion-2 -- ls /tmp/apps
</span></span><span style=display:flex><span>blog.txt
</span></span></code></pre></div></li></ul><hr><h2 id=kubernetes-sidecar-containers>Kubernetes Sidecar Containers</h2><ul><li>We have a web server container running the nginx image. The access and error logs generated by the web server are not critical enough to be placed on a persistent volume. However, Nautilus developers need access to the last 24 hours of logs so that they can trace issues and bugs. Therefore, we need to ship the access and error logs for the web server to a log-aggregation service. Following the separation of concerns principle, we implement the Sidecar pattern by deploying a second container that ships the error and access logs from nginx. Nginx does one thing, and it does it well—serving web pages. The second container also specializes in its task—shipping logs. Since containers are running on the same Pod, we can use a shared emptyDir volume to read and write logs.</li><li>Create a pod named webserver.</li><li>Create an emptyDir volume shared-logs.</li><li>Create two containers from nginx and ubuntu images with latest tag only and remember to mention tag i.e nginx:latest, nginx container name should be nginx-container and ubuntu container name should be sidecar-container on webserver pod.</li><li>Add command on sidecar-container &ldquo;sh&rdquo;,"-c",&ldquo;while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done&rdquo;</li><li>Mount the volume shared-logs on both containers at location /var/log/nginx, all containers should be up and running.</li></ul><h6 id=solution-15>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>webserver</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-logs</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>emptyDir</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-logs</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/log/nginx</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ubuntu:latest </span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sidecar-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;sh&#34;</span>,<span style=color:#e6db74>&#34;-c&#34;</span>,<span style=color:#e6db74>&#34;while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done&#34;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-logs</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/log/nginx</span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl create -f task.yml
</span></span><span style=display:flex><span>$ watch kubectl get pods
</span></span><span style=display:flex><span>$ kubectl get pods webserver -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.spec[&#39;containers&#39;][*].name}&#34;</span> 
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-nginx-web-server-on-kubernetes-cluster>Deploy Nginx Web Server on Kubernetes Cluster</h2><ul><li>Some of the Nautilus team developers are developing a static website and they want to deploy it on Kubernetes cluster. They want it to be highly available and scalable. Therefore, based on the requirements, the DevOps team has decided to create a deployment for it with multiple replicas. Below you can find more details about it:</li><li>Create a deployment using nginx image with latest tag only and remember to mention the tag i.e nginx:latest. Name it as nginx-deployment. The container should be named as nginx-container, also make sure replica counts are 3.</li><li>Create a NodePort type service named nginx-service. The nodePort should be 30011.</li></ul><h6 id=solution-16>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>static-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>static-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>static-app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>static-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30011</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><hr></li></ul><h2 id=print-environment-variables>Print Environment Variables</h2><p>The Nautilus DevOps team is working on to setup some pre-requisites for an application that will send the greetings to different users. There is a sample deployment, that needs to be tested. Below is a scenario which needs to be configured on Kubernetes cluster. Please find below more details about it.</p><ul><li>Create a pod named print-envars-greeting.</li><li>Configure spec as, the container name should be print-env-container and use bash image.</li><li>Create three environment variables:<ul><li>a. GREETING and its value should be Welcome to</li><li>b. COMPANY and its value should be xFusionCorp</li><li>c. GROUP and its value should be Group</li><li>Use command to echo ["$(GREETING) $(COMPANY) $(GROUP)"] message.</li><li>You can check the output using kubectl logs -f print-envars-greeting command.</li></ul></li></ul><h6 id=solution-17>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>print-envars-greeting</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>print-env-container</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;echo&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;$(msg)&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GREETING</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;Welcome to&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>COMPANY</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;xFusionCorp&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GROUP</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;Group&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>msg</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;$(GREETING) $(COMPANY) $(GROUP)&#34;</span>
</span></span></code></pre></div></li></ul><hr><h2 id=rolling-updates-and-rolling-back-deployments-in-kubernetes>Rolling Updates And Rolling Back Deployments in Kubernetes</h2><ul><li>There is a production deployment planned for next week. The Nautilus DevOps team wants to test the deployment update and rollback on Dev environment first so that they can identify the risks in advance. Below you can find more details about the plan they want to execute.</li><li>Create a namespace devops. Create a deployment called httpd-deploy under this new namespace, It should have one container called httpd, use httpd:2.4.25 image and 3 replicas. The deployment should use RollingUpdate strategy with maxSurge=1, and maxUnavailable=2. Also create a NodePort type service named httpd-service and expose the deployment on nodePort: 30008.</li><li>Now upgrade the deployment to version httpd:2.4.43 using a rolling update.</li><li>Finally, once all pods are updated undo the recent update and roll back to the previous/original version.</li></ul><h6 id=solution-18>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>devops</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>: 
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>devops</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd-deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd-deploy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>httpd:2.4.25</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rollingUpdate</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>devops</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>httpd-deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30008</span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl create -f task.yml
</span></span><span style=display:flex><span>$ kubectl get -n devops deployments.apps
</span></span><span style=display:flex><span>$ kubectl set image -n devops deployments/httpd-deploy httpd<span style=color:#f92672>=</span>httpd:2.4.43
</span></span><span style=display:flex><span>$ kubectl rollout history -n xfusion deployments/httpd-deploy <span style=color:#75715e># You should see 1 and 2 versions. which means you are running the 3rd version</span>
</span></span><span style=display:flex><span>$ k rollout undo -n xfusion deployments/httpd-deploy <span style=color:#75715e># now you should see 2 and 3 versions. which means you are running the 1st version</span>
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-jenkins-on-kubernetes-cluster>Deploy Jenkins on Kubernetes Cluster</h2><ul><li>The Nautilus DevOps team is planning to set up a Jenkins CI server to create/manage some deployment pipelines for some of the projects. They want to set up the Jenkins server on Kubernetes cluster. Below you can find more details about the task:</li><li>Create a namespace jenkins</li><li>Create a Service for jenkins deployment. Service name should be jenkins-service under jenkins namespace, type should be NodePort, nodePort should be 30008</li><li>Create a Jenkins Deployment under jenkins namespace, It should be name as jenkins-deployment , labels app should be jenkins , container name should be jenkins-container , use jenkins/jenkins image , containerPort should be 8080 and replicas count should be 1.</li></ul><h6 id=solution-19>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30008</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>jenkins/jenkins</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-grafana-on-kubernetes-cluster>Deploy Grafana on kubernetes Cluster</h2><p>The Nautilus DevOps teams is planning to set up a Grafana tool to collect and analyze analytics from some applications. They are planning to deploy it on Kubernetes cluster. Below you can find more details.</p><ul><li>Create a deployment named grafana-deployment-nautilus using any grafana image for Grafana app. Set other parameters as per your choice.</li><li>Create NodePort type service with nodePort 32000 to expose the app.</li></ul><h6 id=solution-20>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>grafana-deployment-datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>grafana-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>grafana-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>grafana</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>32000</span>
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-tomcat-app-on-kubernetes>Deploy Tomcat App on Kubernetes</h2><p>A new java-based application is ready to be deployed on a Kubernetes cluster. The development team had a meeting with the DevOps team to share the requirements and application scope. The team is ready to setup an application stack for it under their existing cluster. Below you can find the details for this:</p><ul><li>Create a namespace named tomcat-namespace-xfusion.</li><li>Create a deployment for tomcat app which should be named as tomcat-deployment-xfusion under the same namespace you created. Replica count should be 1, the container should be named as tomcat-container-xfusion, its image should be gcr.io/kodekloud/centos-ssh-enabled:tomcat and its container port should be 8080.</li><li>Create a service for tomcat app which should be named as tomcat-service-xfusion under the same namespace you created. Service type should be NodePort and nodePort should be 32227.</li></ul><h6 id=solution-21>Solution</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tomcat-namespace-xfusion</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tomcat-deployment-xfusion</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>tomcat-namespace-xfusion</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>tomcat-xfusion</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>tomcat-xfusion</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>gcr.io/kodekloud/centos-ssh-enabled:tomcat</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tomcat-container-xfusion</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tomcat-service-xfusion</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>tomcat-namespace-xfusion</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>tomcat-xfusion</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>32227</span>
</span></span></code></pre></div></li></ul><hr><h2 id=deploy-node-app-on-kubernetes>Deploy Node App on Kubernetes</h2><p>The Nautilus development team has completed development of one of the node applications, which they are planning to deploy on a Kubernetes cluster. They recently had a meeting with the DevOps team to share their requirements. Based on that, the DevOps team has listed out the exact requirements to deploy the app. Find below more details:</p><ul><li>Create a deployment using gcr.io/kodekloud/centos-ssh-enabled:node image, replica count must be 2.</li><li>Create a service to expose this app, the service type must be NodePort, targetPort must be 8080 and nodePort should be 30012.</li><li>Make sure all the pods are in Running state after the deployment.</li><li>You can check the application by clicking on NodeApp button on top bar.</li><li>You can use any labels as per your choice.
=> Note: The kubectl on jump_host has been configured to work with the kubernetes cluster</li></ul><h6 id=solution-22>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>node-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>node-app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>gcr.io/kodekloud/centos-ssh-enabled:node</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>node-service</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>node-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30012</span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>thor@jump_host ~$ kubectl get pods
</span></span><span style=display:flex><span>NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>node-deployment-dd99d7b78-ftr2r   1/1     Running   <span style=color:#ae81ff>0</span>          2m2s
</span></span><span style=display:flex><span>node-deployment-dd99d7b78-wshn6   1/1     Running   <span style=color:#ae81ff>0</span>          2m2s
</span></span><span style=display:flex><span>thor@jump_host ~$ kubectl get svc
</span></span><span style=display:flex><span>NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>        AGE
</span></span><span style=display:flex><span>kubernetes     ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        30m
</span></span><span style=display:flex><span>node-service   NodePort    10.96.174.163   &lt;none&gt;        80:30012/TCP   3m
</span></span></code></pre></div></li></ul><hr><h2 id=troubleshoot-deployment-issues-in-kubernetes>Troubleshoot Deployment issues in Kubernetes</h2><p>Last week, the Nautilus DevOps team deployed a redis app on Kubernetes cluster, which was working fine so far. This morning one of the team members was making some changes in this existing setup, but he made some mistakes and the app went down. We need to fix this as soon as possible. Please take a look.</p><ul><li><p>The deployment name is redis-deployment. The pods are not in running state right now, so please look into the issue and fix the same.</p></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#using the command `k get events` I found that kubernetes is crashing because of the following errors:</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis:alpin</span> <span style=color:#75715e>#it should be alpine not alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis-container</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>defaultMode</span>: <span style=color:#ae81ff>420</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>redis-conig</span> <span style=color:#75715e>#it should be redis-config, use the command `k get cm`.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config       </span>
</span></span></code></pre></div></li></ul><h2 id=fix-issue-with-lamp-environment-in-kubernetes>Fix issue with LAMP Environment in Kubernetes</h2><p>One of the DevOps team member was trying to install a WordPress website on a LAMP stack which is essentially deployed on Kubernetes cluster. It was working well and we could see the installation page a few hours ago. However something is messed up with the stack now due to a website went down. Please look into the issue and fix it:</p><ul><li>FYI, deployment name is lamp-wp and its using a service named lamp-service. The Apache is using http default port and nodeport is 30008. From the application logs it has been identified that application is facing some issues while connecting to the database in addition to other issues. Additionally, there are some environment variables associated with the pods like MYSQL_ROOT_PASSWORD, MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD, MYSQL_HOST.</li></ul><h6 id=solution-23>Solution</h6><p>To make the trouble shooting process easier, we will create aliases for the following commands:</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>HTTP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get pod -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].spec.containers[0].name}&#39;</span><span style=color:#66d9ef>)</span> ; echo <span style=color:#e6db74>&#34;HTTP: </span>$HTTP<span style=color:#e6db74>&#34;</span> <span style=color:#75715e># HTTP: httpd-php-container</span>
</span></span><span style=display:flex><span>MYSQL<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get pod -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].spec.containers[1].name}&#39;</span><span style=color:#66d9ef>)</span> ; echo <span style=color:#e6db74>&#34;MYSQL: </span>$MYSQL<span style=color:#e6db74>&#34;</span> <span style=color:#75715e># MYSQL: mysql-container0</span>
</span></span><span style=display:flex><span>POD<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get pod -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].metadata.name)}&#39;</span><span style=color:#66d9ef>)</span> ; echo <span style=color:#e6db74>&#34;POD: </span>$POD<span style=color:#e6db74>&#34;</span> <span style=color:#75715e># POD: lamp-wp-56c7c454fc-cq8c2</span>
</span></span></code></pre></div></li></ul><p>Okey, we can list our objects and inspect them.</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get pods,svc,cm,secrets,deployments
</span></span><span style=display:flex><span>NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/lamp-wp-56c7c454fc-cq8c2   2/2     Running   <span style=color:#ae81ff>0</span>          45s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>deployment.apps/lamp-wp   1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           45s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>        AGE
</span></span><span style=display:flex><span>service/kubernetes      ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        2m59s
</span></span><span style=display:flex><span>service/lamp-service    NodePort    10.96.240.157   &lt;none&gt;        80:30009/TCP   45s
</span></span><span style=display:flex><span>service/mysql-service   ClusterIP   10.96.254.52    &lt;none&gt;        3306/TCP       45s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                     TYPE     DATA   AGE
</span></span><span style=display:flex><span>secret/mysql-db-url      Opaque   <span style=color:#ae81ff>1</span>      47s
</span></span><span style=display:flex><span>secret/mysql-host        Opaque   <span style=color:#ae81ff>1</span>      47s
</span></span><span style=display:flex><span>secret/mysql-root-pass   Opaque   <span style=color:#ae81ff>1</span>      48s
</span></span><span style=display:flex><span>secret/mysql-user-pass   Opaque   <span style=color:#ae81ff>2</span>      47s
</span></span></code></pre></div></li></ul><p>You notice that the service is exposed at nodePort 30009 instead of 30008 which is already mentioned in the task description. To fix this we can edit the service.</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get svc lam-service -o yaml &gt; fix.yml
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;s/30009/30008/g&#34;</span> fix.yml
</span></span><span style=display:flex><span>$ kubectl apply -f fix.yml
</span></span></code></pre></div></li></ul><p>After checking the logs using <code>kubectl logs -f $POD -c $HTTP</code> it was shown that there was an incorrect variable. The deployment definiton was safe and following the instructions. Let&rsquo;s look inside the container HTTP itself.</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl exec -it $POD -c $HTTP -- sh
</span></span><span style=display:flex><span>$ cat app/index.php
</span></span><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span>$dbname <span style=color:#f92672>=</span> $_ENV<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;MYSQL_DATABASE&#39;</span><span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>$dbuser <span style=color:#f92672>=</span> $_ENV<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;MYSQL_USER&#39;</span><span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>$dbpass <span style=color:#f92672>=</span> $_ENV<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;MYSQL_PASSWORDS&#39;</span><span style=color:#f92672>]</span>; <span style=color:#75715e>#fix to [&#39;MYSQL_PASSWORD&#39;]</span>
</span></span><span style=display:flex><span>$dbhost <span style=color:#f92672>=</span> $_ENV<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;HOST_MYQSL&#39;</span><span style=color:#f92672>]</span>; <span style=color:#75715e>#fix to [&#39;MYSQL_HOST&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$connect <span style=color:#f92672>=</span> mysqli_connect<span style=color:#f92672>(</span>$dbhost, $dbuser, $dbpass<span style=color:#f92672>)</span> or die<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Unable to Connect to &#39;</span>$dbhost<span style=color:#e6db74>&#39;&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>$test_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SHOW TABLES FROM </span>$dbname<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>$result <span style=color:#f92672>=</span> mysqli_query<span style=color:#f92672>(</span>$test_query<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>$result-&gt;connect_error<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  die<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Connection failed: &#34;</span> . $conn-&gt;connect_error<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Connected successfully&#34;</span>;
</span></span></code></pre></div></li></ul><p>HERE, we caught the TYPOOO!! $dbhost && $dbpass, lets fix them and restart the php-fpm server!</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ service php-fpm restart
</span></span><span style=display:flex><span>$ service php-fpm status
</span></span></code></pre></div></li></ul><p>A quick check on the vars on both containers!</p><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl exec -it $POD -c $HTTP -- env | grep -i MYSQL
</span></span><span style=display:flex><span>$ kubectl exec -it $POD -c $MYSQL -- env | grep -i MYSQL
</span></span><span style=display:flex><span>$ kubectl describe pod | grep -A <span style=color:#ae81ff>6</span> ENV
</span></span></code></pre></div></li></ul><blockquote><p>Click on the <em>App</em> button at the top right to open the app URL in a new tab, notice the msh &ldquo;connected successfully&rdquo;.</p></blockquote><hr><h2 id=deploy-lamp-stack-on-kubernetes-cluster>Deploy Lamp Stack on Kubernetes Cluster</h2><p>The Nautilus DevOps team want to deploy a PHP website on Kubernetes cluster. They are going to use Apache as a web server and Mysql for database. The team had already gathered the requirements and now they want to make this website live. Below you can find more details:</p><ul><li>Create a config map php-config for php.ini with variables_order = &ldquo;EGPCS&rdquo; data.</li><li>Create a deployment named lamp-wp.</li><li>Create two containers under it. First container must be httpd-php-container using image webdevops/php-apache:alpine-3-php7 and second container must be mysql-container from image mysql:5.6. Mount php-config configmap in httpd container at /opt/docker/etc/php/php.ini location.</li><li>Create kubernetes generic secrets for mysql related values like myql root password, mysql user, mysql password, mysql host and mysql database. Set any values of your choice.</li><li>Add some environment variables for both containers:</li><li>MYSQL_ROOT_PASSWORD, MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD and MYSQL_HOST. Take their values from the secrets you created. Please make sure to use env field (do not use envFrom) to define the name-value pair of environment variables.</li><li>Create a node port type service lamp-service to expose the web application, nodePort must be 30008.</li><li>Create a service for mysql named mysql-service and its port must be 3306.</li><li>We already have /tmp/index.php file on jump_host server.</li><li>Copy this file into httpd container under Apache document root i.e /app and replace the dummy values for mysql related variables with the environment variables you have set for mysql related parameters. Please make sure you do not hard code the mysql related details in this file, you must use the environment variables to fetch those values.</li><li>You must be able to access this index.php on node port 30008 at the end, please note that you should see Connected successfully message while accessing this page.</li></ul><h6 id=solution-24>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>php-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>php.ini</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    variables_order=&#34;EGPCS&#34;</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>lamp-wp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>php-mysql-dep</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>php-mysql-dep</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>php-mysql-dep</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd-php-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>webdevops/php-apache:alpine-3-php7</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_ROOT_PASSWORD</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>rootpassword</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_DATABASE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>database</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_USER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>user</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_PASSWORD</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_HOST</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>host</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/opt/docker/etc/php/php.ini</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>php-config</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>subPath</span>: <span style=color:#ae81ff>php.ini</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-container</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mysql:5.6</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_ROOT_PASSWORD</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>rootpassword</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_DATABASE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>database</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_USER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>user</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_PASSWORD</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_HOST</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>host</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>php-config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>php-config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Secret</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-secrets</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>Opaque</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rootpassword</span>: <span style=color:#ae81ff>cm9vdHBhc3N3b3Jk</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>database</span>: <span style=color:#ae81ff>bXlkYg==</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>Y2h4bXhpaQ==</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>Y2h4bXhpaXBhc3N3b3Jk</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>bXlzcWwtc2VydmljZQ==</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>lamp-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>30008</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>php-mysql-dep</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1 </span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3306</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>php-mysql-dep</span>
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl get pods
</span></span><span style=display:flex><span>$ HTTP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get pod  -o<span style=color:#f92672>=</span>jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].spec.containers[0].name}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>$ POD<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get pod  -o<span style=color:#f92672>=</span>jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[*].metadata.name}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>$ kubectl cp /tmp/index.php $POD:/app -c $HTTP
</span></span><span style=display:flex><span>$ kubectl exec -it $POD -c $HTTP -- bash
</span></span><span style=display:flex><span>$ vi /app/index.php
</span></span></code></pre></div></li><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$dbname <span style=color:#f92672>=</span> $_ENV[<span style=color:#e6db74>&#34;MYSQL_DATABASE&#34;</span>];
</span></span><span style=display:flex><span>$dbuser <span style=color:#f92672>=</span> $_ENV[<span style=color:#e6db74>&#34;MYSQL_USER&#34;</span>];
</span></span><span style=display:flex><span>$dbpass <span style=color:#f92672>=</span> $_ENV[<span style=color:#e6db74>&#34;MYSQL_PASSWORD&#34;</span>];
</span></span><span style=display:flex><span>$dbhost <span style=color:#f92672>=</span> $_ENV[<span style=color:#e6db74>&#34;MYSQL_HOST&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$connect <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_connect</span>($dbhost, $dbuser, $dbpass) <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Unable to Connect to &#39;</span><span style=color:#e6db74>$dbhost</span><span style=color:#e6db74>&#39;&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$test_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SHOW TABLES FROM </span><span style=color:#e6db74>$dbname</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>$result <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_query</span>($test_query);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect_error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Connection failed: &#34;</span> <span style=color:#f92672>.</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>connect_error</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Connected successfully&#34;</span>;
</span></span></code></pre></div></li></ul><hr><h2 id=init-containers-in-kubernetes>Init Containers in Kubernetes</h2><p>There are some applications that need to be deployed on Kubernetes cluster and these apps have some pre-requisites where some configurations need to be changed before deploying the app container. Some of these changes cannot be made inside the images so the DevOps team has come up with a solution to use init containers to perform these tasks during deployment. Below is a sample scenario that the team is going to test first.</p><ul><li>Create a Deployment named as ic-deploy-datacenter.</li><li>Configure spec as replicas should be 1, labels app should be ic-datacenter, template&rsquo;s metadata lables app should be the same ic-datacenter.</li><li>The initContainers should be named as ic-msg-datacenter, use image fedora, preferably with latest tag and use command &lsquo;/bin/bash&rsquo;, &lsquo;-c&rsquo; and &rsquo;echo Init Done - Welcome to xFusionCorp Industries > /ic/news&rsquo;. The volume mount should be named as ic-volume-datacenter and mount path should be /ic.</li><li>Main container should be named as ic-main-datacenter, use image fedora, preferably with latest tag and use command &lsquo;/bin/bash&rsquo;, &lsquo;-c&rsquo; and &lsquo;while true; do cat /ic/news; sleep 5; done&rsquo;. The volume mount should be named as ic-volume-datacenter and mount path should be /ic.</li><li>Volume to be named as ic-volume-datacenter and it should be an emptyDir type.</li></ul><h6 id=solution-25>Solution:</h6><ul><li><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-deploy-datacenter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ic-datacenter</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ic-datacenter</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>initContainers</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-msg-datacenter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>fedora:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;/bin/bash&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;echo Init Done - Welcome to xFusioncorp Industries &gt; /ic/news&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-volume-datacenter</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/ic</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-main-datacenter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>fedora:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;/bin/bash&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;while true; do cat /ic/news; sleep 5; done&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-volume-datacenter</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/ic </span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ic-volume-datacenter</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>emptyDir</span>: {}
</span></span></code></pre></div></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://chxmxii.tech/tags/devops/>DevOps</a></span>
<span class=tag><a href=https://chxmxii.tech/tags/sysadmin/>Sysadmin</a></span></p></div><div id=particles-js style=position:fixed;inset:0;z-index:-1></div><script src=https://chxmxii.tech/js/particles.min.js></script><script>particlesJS("particles-js",{particles:{number:{value:25,density:{enable:!0,value_area:800}},color:{value:"#424569"},shape:{type:"circle",stroke:{width:0,color:"#ff3f38"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.2305594644660164,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:3,random:!0,anim:{enable:!1,speed:40,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ff3f38",opacity:.19875815902242794,width:1},move:{enable:!0,speed:6,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!1,mode:"repulse"},onclick:{enable:!1,mode:"push"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})</script></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>© All right reserved chxmxii - 2022</span></div></div><div class=footer__inner><div class=footer__content><span></span></div></div></footer></div><script type=text/javascript src=https://chxmxii.tech/bundle.min.ada905442d53eafc5c125b84cffce974e971bcb52433fb67db20c5af5b964cea37ebd2c16ee6457894372eac0911dd0428f88da966c8e885b160fc6c0fe0fed6.js integrity="sha512-rakFRC1T6vxcEluEz/zpdOlxvLUkM/tn2yDFr1uWTOo369LBbuZFeJQ3LqwJEd0EKPiNqWbI6IWxYPxsD+D+1g=="></script></body></html>